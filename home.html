<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home | Taptap</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <header>
    <h1>Taptap Chat</h1>
    <div id="toolbar">
      <button onclick="showFriends()">Friends</button>
      <button onclick="goToSettings()">Settings</button>
      <button onclick="toggleDarkMode()">üåô / ‚òÄÔ∏è</button>
    </div>
  </header>  <main>
    <section id="friend-list" class="panel hidden">
      <h2>Your Friends</h2>
      <ul id="friends-container"></ul>
    </section><section id="chat-room" class="panel hidden">
  <div id="chat-header"></div>
  <div id="chat-box"></div>
  <div id="message-tools">
    <input type="file" id="fileInput" accept="image/*,video/*,.pdf,.doc,.docx" hidden>
    <button onclick="document.getElementById('fileInput').click()"><i class="fas fa-paperclip"></i></button>
    <input type="text" id="messageInput" placeholder="Type a message...">
    <button onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
  </div>
</section>

  </main>  <footer>
    <p>&copy; 2025 Taptap. <a href="settings.html">Settings</a></p>
  </footer>  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDCj82y63tQFDfOL_kK5DgUpknTqkUpa9E",
      authDomain: "taptapchat-98475.firebaseapp.com",
      projectId: "taptapchat-98475",
      storageBucket: "taptapchat-98475.appspot.com",
      messagingSenderId: "320070262611",
      appId: "1:320070262611:web:1b9fa2023d7f86ac9fe0a1",
      measurementId: "G-5K77B24PLR",
      databaseURL: "https://taptapchat-98475-default-rtdb.firebaseio.com"
    };
    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.database();
    const storage = firebase.storage();

    function showFriends() {
      document.getElementById('friend-list').classList.remove('hidden');
      document.getElementById('chat-room').classList.add('hidden');
      const uid = auth.currentUser.uid;
      db.ref('users/' + uid + '/friends').once('value', snapshot => {
        const friendsContainer = document.getElementById('friends-container');
        friendsContainer.innerHTML = '';
        snapshot.forEach(child => {
          const li = document.createElement('li');
          li.textContent = child.val().name;
          li.onclick = () => openChat(child.key, child.val().name);
          friendsContainer.appendChild(li);
        });
      });
    }

    function openChat(friendId, name) {
      document.getElementById('friend-list').classList.add('hidden');
      document.getElementById('chat-room').classList.remove('hidden');
      document.getElementById('chat-header').textContent = name + ' - Chat';
      loadChat(friendId);
    }

    function loadChat(friendId) {
      const chatBox = document.getElementById('chat-box');
      chatBox.innerHTML = '';
      const uid = auth.currentUser.uid;
      const chatRef = db.ref('chats/' + uid + '_' + friendId);
      chatRef.on('child_added', snap => {
        const msg = snap.val();
        const div = document.createElement('div');
        div.classList.add('message');
        div.innerHTML = `<strong>${msg.sender === uid ? 'You' : msg.senderName}</strong>: ${msg.text || ''}
                         ${msg.media ? `<br><a href="${msg.media}" target="_blank">View File</a>` : ''}
                         <div class="timestamp">${new Date(msg.timestamp).toLocaleString()}</div>`;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
      });
    }

    document.getElementById('fileInput').addEventListener('change', function(event) {
      const file = event.target.files[0];
      const uid = auth.currentUser.uid;
      const storageRef = storage.ref('uploads/' + Date.now() + '_' + file.name);
      storageRef.put(file).then(snapshot => {
        return snapshot.ref.getDownloadURL();
      }).then(url => {
        sendMessage(url);
      });
    });

    function sendMessage(mediaUrl = '') {
      const text = document.getElementById('messageInput').value;
      const friendId = 'selectedFriendId'; // You will dynamically update this later
      const uid = auth.currentUser.uid;
      const chatRef = db.ref('chats/' + uid + '_' + friendId);
      chatRef.push({
        sender: uid,
        senderName: auth.currentUser.displayName || 'Anonymous',
        text,
        media: mediaUrl,
        timestamp: Date.now()
      });
      document.getElementById('messageInput').value = '';
    }

    function goToSettings() {
      window.location.href = 'settings.html';
    }

    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
    }

    auth.onAuthStateChanged(user => {
      if (!user) {
        window.location.href = 'login.html';
      }
    });
  </script>  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    header, footer {
      background: #4CAF50;
      color: white;
      padding: 10px;
      text-align: center;
    }
    #toolbar {
      margin-top: 10px;
    }
    button {
      margin: 5px;
      padding: 10px;
    }
    .hidden { display: none; }
    .panel {
      padding: 10px;
    }
    #chat-box {
      height: 300px;
      overflow-y: scroll;
      background: #f1f1f1;
      padding: 10px;
    }
    .message {
      margin-bottom: 10px;
      border-bottom: 1px solid #ccc;
      padding-bottom: 5px;
    }
    .timestamp {
      font-size: 0.8em;
      color: gray;
    }
    .dark-mode {
      background: #121212;
      color: #e0e0e0;
    }
    .dark-mode header, .dark-mode footer {
      background: #1f1f1f;
    }
  </style></body>
</html>
